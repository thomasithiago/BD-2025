CREATE DATABASE FICHA_MEDICA;

USE FICHA_MEDICA;

CREATE TABLE PACIENTE(
	ID_PACIENTE INT PRIMARY KEY AUTO_INCREMENT,
    NOME VARCHAR(50),
    DATA_NASC DATE,
    SEXO ENUM('Masculino', 'Feminino'),
    ESTADO_CIVIL VARCHAR(20),
    ENDERECO TEXT,
    RG VARCHAR(20),
    TELEFONE VARCHAR(20),
    CONVENIO VARCHAR(100)
);

CREATE TABLE MEDICO(
	ID_MEDICO INT PRIMARY KEY AUTO_INCREMENT,
    NOME VARCHAR(100) NOT NULL
);

CREATE TABLE CONSULTA(
	ID_CONSULTA INT PRIMARY KEY AUTO_INCREMENT,
    ID_PACIENTE INT NOT NULL,
    ID_MEDICO INT NOT NULL,
    DATA_CONSULTA DATE,
    DIAGNOSTICO TEXT,
    FOREIGN KEY (ID_PACIENTE) REFERENCES PACIENTE(ID_PACIENTE),
    FOREIGN KEY (ID_MEDICO) REFERENCES MEDICO(ID_MEDICO)
);

CREATE TABLE EXAME(
	ID_EXAME INT PRIMARY KEY AUTO_INCREMENT,
    ID_CONSULTA INT NOT NULL,
    NOME_EXAME VARCHAR(100) NOT NULL,
    DATA_EXAME DATE,
    FOREIGN KEY (ID_CONSULTA) REFERENCES CONSULTA(ID_CONSULTA)
);

INSERT INTO PACIENTE (ID_PACIENTE, NOME, DATA_NASC, SEXO, ESTADO_CIVIL, ENDERECO, RG, TELEFONE, CONVENIO) VALUES
(1, 'Thiago Thomasi', '2005-06-06', 'Masculino', 'Solteiro', 'Farroupilha', '7585485', '49991687487', 'Prevemax' ),
(2, 'Thiago Balbinot', '2006-02-16', 'Masculino', 'Solteiro', 'Universitario', '35545234', '49991587145', 'ATM Soluções em Tecnologia' ),
(3, 'Rhyan Mezaroba', '2005-10-03', 'Masculino', 'Namorando', 'Floresta', '22458941', '49998481689', 'Videplast' ),
(4, 'Mateus Ferreira', '2004-11-12', 'Masculino', 'Solteiro', 'Cibrazem', '02358745', '49981625680', 'Videplast' );

INSERT INTO MEDICO (ID_MEDICO, NOME) VALUES
(1, 'Jullian Souza'),
(2, 'Costanaro Gomes'),
(3, 'Quidi Árabe'),
(4, 'Jallinn Habbaram');

INSERT INTO CONSULTA (ID_CONSULTA, ID_PACIENTE, ID_MEDICO, DATA_CONSULTA, DIAGNOSTICO) VALUES
(1, 1, 4, '2025-07-03', 'Dor de dente devido ao consumo exagerado de açúcar'),
(2, 2, 2, '2023-08-20', 'Hérnia de disco'),
(3, 3, 1, '2024-12-13', 'Complicações no parto de bebê reborn'),
(4, 4, 3, '2022-06-07', 'Prisão de ventre');

INSERT INTO EXAME (ID_EXAME, ID_CONSULTA, NOME_EXAME, DATA_EXAME) VALUES
(1, 1, 'Panorâmica', '2025-07-03'),
(2, 2, 'Tomografia', '2023-08-20'),
(3, 3, 'Partonanograma', '2024-12-13'),
(4, 4, 'Colonoscopia', '2022-06-07');

SELECT * FROM PACIENTE;

SELECT * FROM MEDICO
ORDER BY NOME;

SELECT 
    P.NOME AS PACIENTE,
    M.NOME AS MEDICO,
    C.DATA_CONSULTA
FROM CONSULTA C
JOIN PACIENTE P ON C.ID_PACIENTE = P.ID_PACIENTE
JOIN MEDICO M ON C.ID_MEDICO = M.ID_MEDICO;

SELECT * FROM EXAME
WHERE DATA_EXAME > '2023-12-31';

SELECT * FROM CONSULTA
WHERE DIAGNOSTICO LIKE '%dor%';

SELECT COUNT(*) AS TOTAL_VIDEPLAST
FROM PACIENTE
WHERE CONVENIO = 'Videplast';

SELECT 
    P.NOME AS PACIENTE,
    E.NOME_EXAME,
    E.DATA_EXAME
FROM EXAME E
JOIN CONSULTA C ON E.ID_CONSULTA = C.ID_CONSULTA
JOIN PACIENTE P ON C.ID_PACIENTE = P.ID_PACIENTE;

SELECT * FROM PACIENTE
WHERE YEAR(CURDATE()) - YEAR(DATA_NASC) > 18;

SELECT 
    P.NOME AS PACIENTE,
    C.DATA_CONSULTA,
    C.DIAGNOSTICO
FROM CONSULTA C
JOIN PACIENTE P ON C.ID_PACIENTE = P.ID_PACIENTE
ORDER BY C.DATA_CONSULTA DESC;

SELECT 
    M.NOME AS MEDICO,
    COUNT(C.ID_CONSULTA) AS TOTAL_CONSULTAS
FROM MEDICO M
JOIN CONSULTA C ON M.ID_MEDICO = C.ID_MEDICO
GROUP BY M.ID_MEDICO;